{% extends 'shared/_MainLayout.html' %}
{% load humanize %}
{% load static %}
{% block content %}
    {% load jalali_tags %}

    <div class="content-wrapper">
<div class="page-title">
                        <div class="row">
                            <div class="col-sm-6">
                                <h4 class="mb-0"> گزارش جزئیات روز {{ day_date|date:"l"}} - {{ day_date| to_jalali:'%Y/%m/%d'}} </h4>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb pt-0 pr-0 float-left float-sm-right ">
                                    <li class="breadcrumb-item"><a href="/" class="default-color">خانه</a></li>
                                    <li class="breadcrumb-item active">گزارش جزئیات روز </li>
                                </ol>
                            </div>
                        </div>
                    </div>


    <div class="row">
        <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
          <div class="card card-statistics h-100">
            <div class="card-body">
              <div class="clearfix">
                <div class="float-left">
                  <span class="text-primary">
                    <i class="fa fa-shopping-cart highlight-icon" aria-hidden="true"></i>
                  </span>
                </div>
                <div class="float-right text-right">
                  <p class="card-text text-dark">خالص فروش</p>
                  <h4>{{ day_report.khales_forosh|floatformat:0|intcomma:False }}</h4>
                </div>
              </div>
              <p class="text-muted pt-3 mb-0 mt-2 border-top">
{#                <i class="fa fa-exclamation-circle mr-1" aria-hidden="true"></i> رشد 81٪ کمتر#}
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
          <div class="card card-statistics h-100">
            <div class="card-body">
              <div class="clearfix">
                <div class="float-left">
                  <span class="text-warning">
                    <i class="fa fa fa-shopping-bag highlight-icon" aria-hidden="true"></i>
                  </span>
                </div>
                <div class="float-right text-right">
                  <p class="card-text text-dark">بهای تمام شده فروش رفته</p>
                  <h4>{{ day_report.baha_tamam_forosh|floatformat:0|intcomma:False }}</h4>
                </div>
              </div>
              <p class="text-muted pt-3 mb-0 mt-2 border-top">
{#                <i class="fa fa-bookmark-o mr-1" aria-hidden="true"></i> مجموع فروش#}
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
          <div class="card card-statistics h-100">
            <div class="card-body">
              <div class="clearfix">
                <div class="float-left">
                  <span class="text-danger">
                    <i class="fa fa-bar-chart-o highlight-icon" aria-hidden="true"></i>
                  </span>
                </div>
                <div class="float-right text-right">
                  <p class="card-text text-dark">سود ناویژه</p>
                  <h4>{{ day_report.sood_navizhe|floatformat:0|intcomma:False }}</h4>
                </div>
              </div>
              <p class="text-muted pt-3 mb-0 mt-2 border-top">
                <i class="fa fa-calendar mr-1" aria-hidden="true"></i> میانگین {{ minfo.sood_navizhe_ave|floatformat:0|intcomma:False }}
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
          <div class="card card-statistics h-100">
            <div class="card-body">
              <div class="clearfix">
                <div class="float-left">
                  <span class="text-success">
                    <i class="fa fa-dollar highlight-icon" aria-hidden="true"></i>
                  </span>
                </div>
                <div class="float-right text-right">
                  <p class="card-text text-dark">سود ویژه</p>
                  <h4>{{ day_report.sood_vizhe|floatformat:0|intcomma:False }}</h4>
                </div>
              </div>
              <p class="text-muted pt-3 mb-0 mt-2 border-top">
                <i class="fa fa-calendar mr-1" aria-hidden="true"></i> میانگین {{ minfo.sood_vizhe_ave|floatformat:0|intcomma:False }}
              </p>
            </div>
          </div>
        </div>
      </div>

        <div class="row">
            <div class="col-md-12 mb-30">
                <div class="col-xl-12 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body">
                            <div class="table-responsive mt-15 ">
                                <h6 class="card-title pb-0 border-0">گزارش روز <span id="total-mandah"
                                                                                     class="text-primary"></span>
                                    ریال </h6>
                                <div class="table-responsive">
                                    <table id="table"
                                           class="table-striped"
                                           data-toggle="table"
                                           data-locale="fa-IR"
                                           data-search="true"
                                           data-show-columns="true"
                                           data-show-export="true"
                                           data-show-refresh="true"
                                           data-show-columns-toggle-all="true"
                                           data-show-pagination-switch="true"
                                           data-show-toggle="true"
                                           data-show-fullscreen="true"
                                           data-buttons="buttons"
                                           data-search-align="left"
                                           data-buttons-class="primary"
                                           data-pagination="true"
                                           data-show-columns-search="true"
                                           data-show-footer="true"
                                           data-page-size="100"
                                           data-remember-order="true"
                                           data-sortable="true"
                                           data-show-search-clear-button="true"
                                           data-sort-name="datef"
                                           data-sort-order="asc"
                                           data-filter-control="true"
                                           data-show-print="true"
                                           data-export-data-type="all"
                                           data-export-types='["excel"]'>
                                        <thead>
                                        <tr class="tr-class-1">
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="year"
                                                data-filter-control="select">سال
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="datef"
                                                data-filter-control="select">تاریخ
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="kol" data-filter-control="select"
                                            >کل
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="kolname" data-filter-control="select"
                                            >نام کل
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="moin" data-filter-control="select"
                                            >معین
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="tafzili" data-filter-control="select"
                                            >تفضیلی
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="syscomment"
                                            >شرح سند
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="bed"
                                                data-sorter="numericSorter"
                                                data-footer-formatter="priceFormatter">بدهکار
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="bes"
                                                data-sorter="numericOnly"
                                                data-footer-formatter="priceFormatter"
                                            >بستانکار
                                            </th>
                                            <th class="card-text text-center" data-sortable="true"
                                                data-field="is_active"
                                                data-filter-control="select"
                                            >فعال
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for s in sanads %}
                                            <tr>
                                                <td class="card-text text-center">{{ s.date|to_jalali:'%Y/%m/%d'|slice:":4" }}</td>
                                                <td class="card-text text-center">{{ s.date|to_jalali:'%Y/%m/%d' }}</td>
                                                <td class="card-text text-center">{{ s.kol }}</td>
                                                <td class="card-text text-center">{{ s.acc_name }}</td> <!-- ستون جدید -->
                                                <td class="card-text text-center">{{ s.moin }}</td>
                                                <td class="card-text text-center">{{ s.tafzili }}</td>
                                                <td class="card-text text-center">{{ s.syscomment }}</td>
                                                <td class="card-text text-center">{{ s.bed|floatformat:0 }}</td>
                                                <td class="card-text text-center">{{ s.bes|floatformat:0 }}</td>
                                                <td class="card-text text-center">
                                                    {% if s.is_active %}
                                                        <span class="text-success"><i class="fa  fa-check icon"
                                                                                      aria-hidden="true"></i></span>
                                                    {% else %}
                                                        <span class="text-danger"><i class="fa fa-asterisk icon"
                                                                                     aria-hidden="true"></i></span>
                                                    {% endif %}

                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
{% endblock %}





{% block date %}
    <script src="{% static 'js/table1/tableExport.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-locale-all.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-export.min.js' %}"></script>
    <script src="{% static 'js/table1/natural-sorting.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-filter-control.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-print.min.js' %}"></script>
    <script src="{% static 'js/table1/jspdf.min.js' %}"></script>
    <script src="{% static 'js/table1/jspdf.plugin.autotable.js' %}"></script>


    <script>
        var $table = $('#table');
        var totalMandah = 0; // متغیر برای ذخیره مجموع مانده

        $(function () {
            $table.bootstrapTable();
            updateTotalMandah(); // به‌روزرسانی نمایش مجموع مانده هنگام بارگذاری جدول
        });

        function priceFormatter(data) {
            var field = this.field;
            console.log("Data received for priceFormatter:", data);
            var result = data.map(function (row) {
                var valueString = row[field].replace(/,/g, ''); // حذف کاماها
                var value = parseFloat(valueString);
                console.log("Processing row:", row);
                console.log("Parsed value:", value);
                return isNaN(value) ? 0 : value;
            }).reduce(function (sum, i) {
                console.log("Current sum:", sum);
                return sum + i;
            }, 0);
            console.log("Final result for priceFormatter:", result);
            totalMandah = result; // ذخیره مجموع مانده
            updateTotalMandah(); // به‌روزرسانی نمایش مجموع مانده
            return result.toLocaleString('fa-IR'); // نمایش با کاما به صورت 3 تا 3 تا
        }

        function updateTotalMandah() {
            $('#total-mandah').text(totalMandah.toLocaleString('fa-IR'));
        }
    </script>
    <script>
        function numericSorter(a, b) {
            return parseFloat(a) - parseFloat(b);
        }
    </script>


{% endblock %}
