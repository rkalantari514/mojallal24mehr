{% extends 'shared/_MainLayout.html' %}
{% load humanize %}
{% load static %}
{% block content %}
    {% load jalali_tags %}
    {% load custom_filters %}

    <div class="content-wrapper">

        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    <div class="d-block">
                        <h5 class="card-title text-facebook pb-0 border-0">
                            {{ hesabmoshtari.person.name }} {{ hesabmoshtari.person.lname }}
                            {% if hesabmoshtari.total_mandeh > 0 %}
                                <span class="badge badge-pill badge-success">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±</span>
                            {% elif hesabmoshtari.total_mandeh == 0 %}
                                <span class="badge badge-pill badge-primary">Ø¨ÛŒ Ø­Ø³Ø§Ø¨</span>
                            {% elif hesabmoshtari.total_mandeh < 0 %}
                                <span class="badge badge-pill badge-danger">Ø¨Ø¯Ù‡Ú©Ø§Ø±</span>
                            {% endif %}
                        </h5>
                    </div>

                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb pt-0 pr-0 float-left float-sm-right">
                        <li class="breadcrumb-item"><a href="/" class="default-color"> Ø®Ø§Ù†Ù‡</a></li>
                        <li class="breadcrumb-item active">Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</li>
                        <li class="breadcrumb-item active">
                            {{ hesabmoshtari.person.lname }} {{ hesabmoshtari.person.name }}
                        </li>

                    </ol>
                </div>
            </div>
            <!-- Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„ Ø®Ù„Ø§ØµÙ‡ Ù‡Ø§ -->
            <div class="row">
                <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body">
                            <div class="clearfix">
                                <div class="float-left icon-box bg-primary rounded-circle">
    <span class="text-white">
    <i class="fa fa-dollar highlight-icon" aria-hidden="true"></i>
    </span>
                                </div>
                                <div class="float-right text-right">
                                    <p class="card-text text-dark">Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨</p>
                                    <h4 style="direction: ltr">{{ hesabmoshtari.total_mandeh|floatformat:0|intcomma:False }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body">
                            <div class="clearfix">
                                <div class="float-left icon-box bg-danger rounded-circle">
    <span class="text-white">
    <i class="fa fa-hourglass-end highlight-icon" aria-hidden="true"></i>
    </span>
                                </div>
                                <div class="float-right text-right">
                                    <p class="card-text text-dark"> Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ </p>
                                    <h4> {{ hesabmoshtari.from_last_daryaft|floatformat:0|intcomma:False }} Ø±ÙˆØ² Ù‚Ø¨Ù„</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body">
                            <div class="clearfix">
                                <div class="float-left icon-box {% if khab %} bg-danger {% else %} bg-facebook {% endif %}   rounded-circle">
    <span class="text-white">
    <i class="fa fa-bed highlight-icon" aria-hidden="true"></i>
    </span>
                                </div>
                                <div class="float-right text-right">
                                    {% if khab %}
                                    <p class="card-text text-dark"> Ø®ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ÛŒ </p>
                                    {% else %}
                                    <p class="card-text text-dark"> Ø®ÙˆØ§Ø¨ Ø·Ù„Ø¨ </p>
                                    {% endif %}
                                    <h4> {{ hesabmoshtari.sleep_investment|intword }} Ø±ÙˆØ² </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Ø±Ø¯ÛŒÙ Ù†Ù…ÙˆØ¯Ø§Ø± -->

            <div class="row">
                <div class="col-md-12 mb-30">
                    <div class="col-xl-12 mb-30">
                        <div class="card card-statistics h-100">
                            <div class="card-body">
                                <div class="table-responsive mt-15 ">
                                    <h5 class="card-title pb-0 border-0">Ù†Ù…ÙˆØ¯Ø§Ø± Ú¯Ø±Ø¯Ø´ Ø­Ø³Ø§Ø¨</h5>
                                </div>

                                <div class="chart-container ">
<canvas id="Chart1" style="height: 400px; width: 100%;"></canvas>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>





            <!-- Ø±Ø¯ÛŒÙ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª ÙˆØ§Ù… Ù‡Ø§ -->
            <div class="row">
                <div class="col-md-5 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body col-12">
                            <h5 class="card-title pb-0 border-0 ">Ø®Ù„Ø§ØµÙ‡ ÙˆØ§Ù… Ù‡Ø§</h5>
                            <div class="table-responsive">
                                <table class="table center-aligned-table mb-10 text-center ">
                                    <thead>
                                    <tr class="text-dark">
                                        <th>Ø±Ø¯ÛŒÙ</th>
                                        <th>Ú©Ø¯ ÙˆØ§Ù…</th>
                                        <th>ØªØ§Ø±ÛŒØ® ÙˆØ§Ù…</th>
                                        <th>ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ø³Ø§Ø·</th>
                                        <th>Ù…Ø¨Ù„Øº Ø§ÙˆÙ„ÛŒÙ‡</th>
                                        <th>Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡</th>
                                        <th>Ù…Ø¹ÙˆÙ‚</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for loan in hesabmoshtari.loans.all %}
                                        <tr>
                                            <td><h6>{{ forloop.counter }}</h6></td>
                                            <td><h6>{{ loan.code }}</h6></td>
                                            <td><h6>{{ loan.tarikh }}</h6></td>
                                            <td><h6>{{ loan.number }}</h6></td>
                                            <td><h6>{{ loan.cost|floatformat:0|intcomma:False }}</h6></td>
                                            <td><h6>{{ loan.actual_loan_mandeh|floatformat:0|intcomma:False }}</h6></td>
                                            <td><h6>{{ loan.delayed_loan|floatformat:0|intcomma:False }}</h6></td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-md-7 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body">
                            <h5 class="card-title pb-0 border-0 ">Ø¬Ø²Ø¦ÛŒØ§Øª ÙˆØ§Ù… Ù‡Ø§</h5>
                            <div class="table-responsive scrollbar max-h-380">
                                {% for loan in hesabmoshtari.loans.all %}
                                    <div class="table-responsive">
                                        <table class="table center-aligned-table mb-10 text-center ">
                                            <thead>
                                            <tr class="text-dark">
                                                <th>Ú©Ø¯ ÙˆØ§Ù…</th>
                                                <th>Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø³Ø·</th>
                                                <th>ØªØ§Ø±ÛŒØ®</th>
                                                <th> ØªØ§Ø±ÛŒØ® Ø¯Ø±ÛŒØ§ÙØª</th>
                                                <th>Ù…Ø¨Ù„Øº</th>
                                                <th>Ø¯Ø±ØµØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for lo in loan.loandetil_set.all %}
                                                <tr>
                                                    <td>{{ loan.code }}</td>
                                                    <td>{{ lo.row }}</td>
                                                    <td>{{ lo.tarikh }}</td>
                                                    <td>{{ lo.recive_tarikh }}</td>
                                                    <td>{{ lo.cost|floatformat:0|intcomma:False }}</td>
                                                    <td>{{ lo.complete_percent|percentage }}%</td>
                                                    <td>
                                                        {% if lo.complete_percent == 1 %}
                                                            {% if lo.date < today %}
                                                                <span class="btn btn-sm btn-success">Ù¾Ø§Ø³</span>
                                                            {% else %}
                                                                <span class="btn btn-sm btn-info">ØªØ¹Ø¬ÛŒÙ„</span>
                                                            {% endif %}
                                                        {% elif lo.date < today %}
                                                            <span class="btn btn-sm btn-danger">Ù…Ø¹ÙˆÙ‚</span>
                                                        {% else %}
                                                            <span class="btn btn-sm btn-primary">Ø¹Ø§Ø¯ÛŒ</span>
                                                        {% endif %}
                                                    </td>

                                                </tr>
                                            {% endfor %}

                                            </tbody>
                                        </table>
                                    </div>
                                {% endfor %}

                            </div>
                        </div>
                    </div>

                </div>
            </div>


            <!-- Ø±Ø¯ÛŒÙ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ -->
            <div class="row">
                <!-- Ø±Ø¯ÛŒÙ Ù¾ÛŒØ§Ù…Ú© -->
                <div class="col-xl-4 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="p-4 text-center bg-success">
                            <h5 class="mb-60 text-white"> </h5>
                        </div>
                        <div class="card-body text-center">
                            <div class="avatar-top">
                                <img class="img-fluid w-25 rounded-circle " src="{% static 'images/noimage.png' %}"
                                     alt="">
                            </div>
                            <h5 class="card-title text-facebook pb-0 border-0">{{ hesabmoshtari.person.clname }}</h5>
                                <div class="card-body">
                                    <div class="clearfix">
                                        <div class="float-left icon-box bg-success rounded-circle">
                  <span class="text-white">
                    <i class="fa fa-envelope highlight-icon" aria-hidden="true"></i>
                  </span>
                                        </div>
                                        <div class="float-right text-right">
                                            <h4>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾ÛŒØ§Ù…Ú©ÛŒ</h4>
                                        </div>
                                    </div>
                                </div>

                            <div class="social-icons color-icon mt-20">
                                <ul>
                                    {% if gh in hesabmoshtari.person %}
                                        <li class="social-rss"><a href="#"><i class="fa fa-rss"></i></a></li>
                                    {% endif %}
                                    {#                    <li class="social-facebook"><a href="#"><i class="fa fa-facebook"></i></a></li>#}
                                    {#                    <li class="social-twitter"><a href="#"><i class="fa fa-twitter"></i></a></li>#}
                                    {#                    <li class="social-github"><a href="#"><i class="fa fa-github"></i></a></li>#}
                                    {#                    <li class="social-youtube"><a href="#"><i class="fa fa-youtube"></i></a></li>#}
                                    {#                    <li class="social-instagram"><a href="#"><i class="fa fa-instagram"></i></a></li>#}
                                </ul>
                            </div>
                            <form method="POST">
                                {% csrf_token %}
                                {{ sms_form.as_p }}
                                <button type="submit" name="action" value="send_sms" class="btn btn-success">Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…Ú©
                                </button>
                            </form>


                            {#               <div class="divider mt-20"></div>#}
                            {#               <div class="row">#}
                            {#                  <div class="col-6 col-sm-4 mt-30">#}
                            {#                     <b>Ù¾Ø±ÙˆÚ˜Ù‡</b>#}
                            {#                     <h4 class="text-success mt-10">09</h4>#}
                            {#                  </div>#}
                            {#                  <div class="col-6 col-sm-4 mt-30">#}
                            {#                    <b>Ù¾ÛŒØ§Ù… Ù‡Ø§ </b>#}
                            {#                     <h4 class="text-danger mt-10">255</h4>#}
                            {#                  </div>#}
                            {#                  <div class="col-12 col-sm-4 mt-30">#}
                            {#                    <b>Ù†Ù…Ø§ÛŒØ´ Ù‡Ø§</b>#}
                            {#                     <h4 class="text-warning mt-10">608</h4>#}
                            {#                  </div>#}
                            {#                </div>#}
                        </div>
                    </div>
                </div>
                <!-- Ø±Ø¯ÛŒÙ ØªÙ„ÙÙ† -->
                <div class="col-xl-4 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="p-4 text-center bg-primary">
                            <h5 class="mb-60 text-white"> </h5>
                        </div>
                        <div class="card-body text-center">
                            <div class="avatar-top">
                                <img class="img-fluid w-25 rounded-circle " src="{% static 'images/noimage.png' %}"
                                     alt="">
                            </div>
                            <h5 class="card-title text-facebook pb-0 border-0">{{ hesabmoshtari.person.clname }}</h5>
                                <div class="card-body">
                                    <div class="clearfix">
                                        <div class="float-left icon-box bg-primary rounded-circle">
                  <span class="text-white">
                    <i class="fa fa-phone highlight-icon" aria-hidden="true"></i>
                  </span>
                                        </div>
                                        <div class="float-right text-right">
                                            <h4>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ØªÙ„ÙÙ†ÛŒ</h4>
                                        </div>
                                    </div>
                                </div>
                            <div class="social-icons color-icon mt-20">
                                <ul>
                                    {% if gh in hesabmoshtari.person %}
                                        <li class="social-rss"><a href="#"><i class="fa fa-rss"></i></a></li>
                                    {% endif %}
                                </ul>
                            </div>
                            <form method="POST">
                                {% csrf_token %}

                                <!-- Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† -->
                                <label for="id_phone_number">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†:</label>
                                {{ call_form.phone_number }}

                                <!-- Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ ØªÙ…Ø§Ø³ (Ø¯Ø±Ø³Øª Ø¨Ø¹Ø¯ Ø§Ø² Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†) -->
                                <button type="button" id="start_call" class="btn btn-success mt-3">Ø´Ø±ÙˆØ¹ ØªÙ…Ø§Ø³ (0s)
                                </button>
                                <!-- Ø¯Ú©Ù…Ù‡ Ø§Ù†ØµØ±Ø§Ù -->
                                <button type="button" id="cancel_call" class="btn btn-secondary mt-3">Ø§Ù†ØµØ±Ø§Ù ØªÙ…Ø§Ø³
                                </button>
                                <br>
                                <br>
                                <!-- Ø³Ø§ÛŒØ± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙØ±Ù… -->
                                <label for="id_call_status">ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø§Ø³:</label>
                                {{ call_form.call_status }}

                                <label for="id_call_description">Ø´Ø±Ø­ ØªÙ…Ø§Ø³:</label>
                                {{ call_form.call_description }}

                                <label for="id_next_reminder_date">Ø²Ù…Ø§Ù† Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¨Ø¹Ø¯ÛŒ:</label>
                                {{ call_form.next_reminder_date }}

                                <input type="hidden" id="call_duration" name="call_duration" value="0">

                                <button type="submit" name="action" value="track_call" class="btn btn-primary mt-3">Ø«Ø¨Øª
                                    Ú¯Ø²Ø§Ø±Ø´ ØªÙ…Ø§Ø³
                                </button>
                            </form>

                        </div>
                    </div>
                </div>
            </div>


            <!-- Ø±Ø¯ÛŒÙ Ú¯Ø²Ø§Ø±Ø´ Ø§Ù‚Ø³Ø§Ø· -->
            <div class="row">

                <div class="col-xl-12 mb-30">
                    <div class="card card-statistics h-100">
                        <div class="card-body">
                            <h5 class="card-title pb-0 border-0">Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù‡Ø§ </h5>
                            <h5 class="card-title pb-0 border-0 text-warning">Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¨Ø¹Ø¯ÛŒ{{ tracking.first.next_reminder_date|timeuntil }} Ø¯ÛŒÚ¯Ø± </h5>
                            <div class="table-responsive scrollbar max-h-500">
                                <div class="table-responsive">


                                    <table class="table center-aligned-table mb-0">
    <thead>
        <tr class="text-dark">
            <th>Ø±Ø¯ÛŒÙ</th>
            <th>Ø§Ù‚Ø¯Ø§Ù… Ú©Ù†Ù†Ø¯Ù‡</th>
            <th>Ù†ÙˆØ¹ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
            <th>Ø²Ù…Ø§Ù†</th>
            <th>Ø³Ø·Ø­ Ù¾ÛŒØ§Ù…Ú©</th>
            <th>Ø´Ø±Ø­</th>
            <th>ØªÙ„ÙÙ†</th>
{#            <th>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¨Ø¹Ø¯ÛŒ</th>#}
        </tr>
    </thead>
<tbody>
    {% for t in tracking %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>
                {% if t.created_by %}
                    <img class="img-fluid avatar-small" src="{{ t.created_by.avatar.url }}" alt="">
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                {% if t.call_status == 4 %}
                                    <i class="fa fa-hourglass-start text-warning fa-2x"></i>

                {% else %}
                <i class="fa {{ t.track_kind.kind_icon }} text-{{ t.track_kind.kind_color }} fa-2x"></i>
                {% endif %}
            </td>

            <!-- ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ§Ù…Ú© ÛŒØ§ ØªÙ…Ø§Ø³ -->
            <td>

                {% if t.track_kind.is_call_related %}
                    <span class="{{ t.get_call_status_details.color }}">
                        <i class="fa {{ t.get_call_status_details.icon }}"></i>
                        {{ t.get_call_status_details.persian }}
                    </span>
                {% else %}
                    <span class="{{ t.get_status_details.color }}">
                        <i class="fa {{ t.get_status_details.icon }}"></i>
                        {{ t.get_status_details.persian }}
                    </span>
                {% endif %}
            </td>

            <td>{{ t.created_at|to_jalali:"%Y/%m/%d - %H:%M" }}</td>
            <td>{{ t.sample_sms.level|default:"-" }}</td>

            <!-- Ù†Ù…Ø§ÛŒØ´ Ø´Ø±Ø­ ØªÙ…Ø§Ø³ ÛŒØ§ Ù¾ÛŒØ§Ù…Ú© -->
            <td>
                {% if t.track_kind.is_call_related %}
                    {{ t.call_description|default:"-" }}
                {% else %}
                    {{ t.message_to_send|default:"-" }}
                {% endif %}
            </td>

            <td>{{ t.phone_number|default:"-" }}</td>
{#            <td>{{ t.next_reminder_date|timeuntil }}</td>#}
        </tr>
    {% endfor %}
</tbody>
</table>







                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>


            <!-- Ø±Ø¯ÛŒÙ Ø¬Ø²Ø¦ÛŒØ§Øª Ø§Ø³Ù†Ø§Ø¯ -->
            <div class="row">
                <div class="col-md-12 mb-30">
                    <div class="col-xl-12 mb-30">
                        <div class="card card-statistics h-100">
                            <div class="card-body">
                                <div class="table-responsive mt-15 ">
                                    <h6 class="card-title pb-0 border-0">Ù…Ø§Ù†Ø¯Ù‡
                                        Ø­Ø³Ø§Ø¨ {{ hesabmoshtari.person.name }} {{ hesabmoshtari.person.lname }} :</h6>
                                    <h5 class="card-title pb-0 border-0"><span id="total-mandah"
                                                                               class="text-primary"></span>
                                        Ø±ÛŒØ§Ù„ </h5>
                                    <div class="table-responsive">
                                        <table id="table"
                                               class="table-striped"
                                               data-toggle="table"
                                               data-locale="fa-IR"
                                               data-search="true"
                                               data-show-columns="true"
                                               data-show-export="true"
                                               data-show-refresh="true"
                                               data-show-columns-toggle-all="true"
                                               data-show-pagination-switch="true"
                                               data-show-toggle="true"
                                               data-show-fullscreen="true"
                                               data-buttons="buttons"
                                               data-search-align="left"
                                               data-buttons-class="primary"
                                               data-pagination="true"
                                               data-show-columns-search="true"
                                               data-show-footer="true"
                                               data-page-size="10"
                                               data-remember-order="true"
                                               data-sortable="true"
                                               data-show-search-clear-button="true"
                                                {#                                                   data-sort-name="date"#}
                                               data-sort-order="asc"
                                               data-filter-control="true"
                                               data-show-print="true"
                                               data-export-data-type="all"
                                               data-export-types='["excel"]'>
                                            <thead>
                                            <tr class="tr-class-1">
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="code"
                                                    data-filter-control="input">Ú©Ø¯
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="radif"
                                                    data-filter-control="input">Ø±Ø¯ÛŒÙ
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="date"
                                                    data-filter-control="select">ØªØ§Ø±ÛŒØ®
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="kind" data-filter-control="select">Ù†ÙˆØ¹
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="sharh"
                                                    data-filter-control="input">Ø´Ø±Ø­ Ø³Ù†Ø¯
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="bed" data-footer-formatter="priceFormatter">Ø¨Ø¯Ù‡Ú©Ø§Ø±
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="bes" data-footer-formatter="priceFormatter">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±
                                                </th>
                                                <th class="card-text text-center" data-sortable="true"
                                                    data-field="mandeh" >Ù…Ø§Ù†Ø¯Ù‡ Ú©Ù„
                                                </th>
                                                {#                                                <th class="card-text text-center" data-sortable="true"#}
                                                {#                                                    data-field="mandkol"#}
                                                {#                                                    data-filter-control="select">Ù…Ø§Ù†Ø¯Ù‡ Ú©Ù„#}
                                                {#                                                </th>#}

                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for s in asnad %}
                                                <tr>
                                                    <td class="card-text text-center">{{ s.code }}</td>
{#                                                    <td class="card-text text-center">{{ s.radif }}</td>#}
                                                    <td class="card-text text-center">{{ s.acc_year }}</td>
                                                    <td class="card-text text-center">{{ s.tarikh }}</td>
                                                    {#                                                    <td class="card-text text-center ">{{ s.kind.0 }}</td>#}
                                                    <td class="card-text text-center text-{{ s.kind.2 }}">{{ s.kind.1 }}</td>
                                                    {#                                                     <td class="card-text text-center ">{{ s.syscomment }}</td>#}
                                                    <td class="card-text text-center ">
                                                        {% if s.syscomment %}
                                                            {{ s.syscomment }}
                                                        {% else %}
                                                            {{ s.sharh }}
                                                        {% endif %}
                                                    </td>

                                                    <td class="card-text text-center">{{ s.bed|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ s.bes|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center"
                                                        style="direction: ltr">{{ s.mandeh|floatformat:0|intcomma:False }}</td>
                                                    {#                                                    <td class="card-text text-center"></td>#}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>


    </div>


{% endblock %}





{% block myjs %}
    <script>
        document.getElementById("start_call").addEventListener("click", function () {
            let button = this;

            if (button.classList.contains("btn-success")) {
                button.textContent = "Ù¾Ø§ÛŒØ§Ù† ØªÙ…Ø§Ø³ (0s)";
                button.classList.remove("btn-success");
                button.classList.add("btn-danger");

                let counter = 0;
                let timer = setInterval(() => {
                    counter++;
                    document.getElementById("call_duration").value = counter;
                    button.textContent = `Ù¾Ø§ÛŒØ§Ù† ØªÙ…Ø§Ø³ (${counter}s)`; // ğŸ”¹ Ù†Ù…Ø§ÛŒØ´ Ø«Ø§Ù†ÛŒÙ‡ Ø¯Ø§Ø®Ù„ Ø¯Ú©Ù…Ù‡
                }, 1000);

                button.setAttribute("data-timer", timer);

                let phoneNumber = document.getElementById("id_phone_number").value;
                window.location.href = `tel:${phoneNumber}`;

            } else {
                clearInterval(button.getAttribute("data-timer"));
                button.classList.remove("btn-danger");
                button.classList.add("btn-secondary");
                button.textContent = `ØªÙ…Ø§Ø³ Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª (${document.getElementById("call_duration").value}s)`;
            }
        });

        // ğŸ›  Ø¯Ú©Ù…Ù‡ Ø§Ù†ØµØ±Ø§Ù -> ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† ØªÙ…Ø§Ø³ Ø¨Ù‡ ØµÙØ± Ùˆ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø´Ø±Ø­ ØªÙ…Ø§Ø³
        document.getElementById("cancel_call").addEventListener("click", function () {
            clearInterval(document.getElementById("start_call").getAttribute("data-timer"));
            document.getElementById("call_duration").value = "0";
            document.getElementById("start_call").textContent = "Ø´Ø±ÙˆØ¹ ØªÙ…Ø§Ø³ (0s)";
            document.getElementById("start_call").classList.remove("btn-danger", "btn-secondary");
            document.getElementById("start_call").classList.add("btn-success");

            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ø´Ø±Ø­ ØªÙ…Ø§Ø³
            document.getElementById("id_call_description").value = "";
        });
    </script>



<script>
    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ø³â€ŒØ¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø² Django
    const chartLabels = {{ chart_labels|safe }}; // Ù„ÛŒØ³Øª Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®
    const chartDataSets = {{ chart_date|safe }}; // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ø³Ø§Ù„ØŒ Ù„ÛŒØ³Øª Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§
    const yearList = {{ year_list|safe }}; // Ù„ÛŒØ³Øª Ø³Ø§Ù„â€ŒÙ‡Ø§

    // Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø³Ø§Ù„ - Ø§Ú¯Ø± ØªØ¹Ø¯Ø§Ø¯ Ø³Ø§Ù„â€ŒÙ‡Ø§ Ø¨ÛŒØ´ØªØ± Ø´Ø¯ØŒ Ø¨Ø§ÛŒØ¯ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
    const colors = [
        'blue', 'green', 'red', 'teal', 'orange', 'purple', 'brown', 'cyan', 'magenta', 'lime'
    ];

    // Ø³Ø§Ø®Øª Dataset Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø³Ø§Ù„
    const datasets = chartDataSets.map((data, index) => ({
        label: `Ø³Ø§Ù„ ${yearList[index]}`,
        data: data,
        borderColor: colors[index % colors.length],
        fill: false,
        pointRadius: 0,
        // Ø­Ø°Ù Ø®Ø·ÙˆØ· Ø®Ø·â€ŒØ®Ø·ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ
        // borderDash: [5, 5], // Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒØ¯ Ø®Ø·â€ŒÙ‡Ø§ÛŒ Ø®Ø·â€ŒÚ†ÛŒÙ† Ø¨Ø§Ø´Ø¯ØŒ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯
    }));

    // Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø±
    const ctx = document.getElementById('Chart1').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartLabels,
            datasets: datasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: { display: true, text: "ØªØ§Ø±ÛŒØ®" }
                },
                y: {
                    title: { display: true, text: "Ù…Ù‚Ø¯Ø§Ø± ØªØ¬Ù…Ø¹ÛŒ" }
                }
            },
            plugins: {
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function (context) {
                            // ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± 10 Ù…ÛŒÙ„ÛŒÙˆÙ†ØŒ Ø¨Ø§ ÛŒÚ© Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±
                            var value = context.parsed.y / 10000000;
                            return context.dataset.label + ': ' + value.toFixed(1) + ' Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†';
                        },
                        title: function (tooltipItems) {
                            return 'ØªØ§Ø±ÛŒØ®: ' + tooltipItems[0].label;
                        }
                    }
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
</script>



{% endblock %}


{% block date %}
    <script src="{% static 'js/table1/tableExport.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-locale-all.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-export.min.js' %}"></script>
    <script src="{% static 'js/table1/natural-sorting.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-filter-control.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-print.min.js' %}"></script>
    <script src="{% static 'js/table1/jspdf.min.js' %}"></script>
    <script src="{% static 'js/table1/jspdf.plugin.autotable.js' %}"></script>

    <script>
        var $table = $('#table');
        var totalMandah = 0; // Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø§Ù†Ø¯Ù‡

        $(function () {
            $table.bootstrapTable();
            updateTotalMandah(); // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø§Ù†Ø¯Ù‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÙˆÙ„
        });

        function priceFormatter(data) {
            var field = this.field;
            {#console.log("Data received for priceFormatter:", data);#}
            var result = data.map(function (row) {
                var valueString = row[field].replace(/,/g, ''); // Ø­Ø°Ù Ú©Ø§Ù…Ø§Ù‡Ø§
                var value = parseFloat(valueString);
                {#console.log("Processing row:", row);#}
                {#console.log("Parsed value:", value);#}
                return isNaN(value) ? 0 : value;
            }).reduce(function (sum, i) {
                {#console.log("Current sum:", sum);#}
                return sum + i;
            }, 0);
            {#console.log("Final result for priceFormatter:", result);#}
            totalMandah = result; // Ø°Ø®ÛŒØ±Ù‡ Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø§Ù†Ø¯Ù‡
            updateTotalMandah(); // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø§Ù†Ø¯Ù‡
            return result.toLocaleString('fa-IR'); // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¨Ù‡ ØµÙˆØ±Øª 3 ØªØ§ 3 ØªØ§
        }

        function updateTotalMandah() {
            $('#total-mandah').text(totalMandah.toLocaleString('fa-IR'));
        }
    </script>




{% endblock %}




