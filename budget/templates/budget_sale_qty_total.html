{% extends 'shared/_MainLayout.html' %}
{% load static %}
{% load humanize %}
{% block content %}
    <style>
        .category-btn {
            width: 300px;
            margin-bottom: 10px;
        }
        .btn-fixed-width {
            width: 140px;
            text-align: right;
        }
    </style>
    <style>
        label { display: none !important; }
        #chartdiv svg text { display: none; }
        .am5-label { visibility: hidden; }
    </style>
    <div class="content-wrapper">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    <div class="d-block">
                        <h4 class="card-title text-facebook pb-0 border-0">گزارش کلیات بودجه فروش مقداری
                            سال {{ acc_year }}</h4>
                    </div>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb pt-0 pr-0 float-left float-sm-right">
                        <li class="breadcrumb-item"><a href="/" class="default-color"> خانه</a></li>
                        <li class="breadcrumb-item active">گزارش کلیات بودجه فروش مقداری سال {{ acc_year }}</li>
                    </ol>
                </div>
            </div>

            <!-- ردیف خلاصه فروش سطح 0 -->
            <div class="row">
                <div class="col-md-12 mb-30">
                    <div class="col-xl-12 mb-30">
                        <div class="card card-statistics h-100">
                            <div class="card-body">
                                <div class="table-responsive mt-15 ">
                                    <h6 class="card-title pb-0 border-0">عملکرد فروش مقداری سال {{ acc_year }}</h6>
                                    <div class="table-responsive">
                                        <table id="table"
                                               class="table-striped"
                                               data-toggle="table"
                                               data-locale="fa-IR"
                                               data-search="true"
                                               data-show-columns="true"
                                               data-show-export="true"
                                               data-show-refresh="true"
                                               data-show-columns-toggle-all="true"
                                               data-show-pagination-switch="true"
                                               data-show-toggle="true"
                                               data-show-fullscreen="true"
                                               data-buttons="buttons"
                                               data-search-align="left"
                                               data-buttons-class="primary"
                                               data-pagination="true"
                                               data-show-columns-search="true"
                                               data-show-footer="true"
                                               data-page-size="100"
                                               data-remember-order="true"
                                               data-sortable="true"
                                               data-show-search-clear-button="true"
                                               data-sort-name="cy_factor"
                                               data-sort-order="desc"
                                               data-filter-control="true"
                                               data-show-print="true"
                                               data-export-data-type="all"
                                               data-export-types='["excel"]'>
                                            <thead>
                                            <tr class="tr-class-1">
                                                <th></th>
                                                <th data-field="by_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter"> کل
                                                    فروش{{ base_year }} (تعداد)</th>
                                                <th data-field="by_today_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    فروش{{ base_year }} تا امروز (تعداد)
                                                </th>
                                                <th data-field="budget_rate" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب بودجه
                                                </th>
                                                <th data-field="actual_ratio_by_year" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب واقعی
                                                </th>
                                                <th data-field="cy_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    بودجه{{ acc_year }} (تعداد)</th>
                                                <th data-field="cy_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">فروش{{ acc_year }}تا امروز (تعداد)
                                                </th>
                                                <th data-field="cy_today_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }} با آهنگ
                                                    پارسال تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_year_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (آهنگ پارسال)
                                                </th>
                                                <th data-field="cy_today_budget_line" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }}
                                                    بصورت خطی تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_line_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (خطی)
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for item in table0 %}
                                                <tr>
                                                    <td>
                                                        <a href="/budget/sale/qty/detail/0/0"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success btn-fixed-width">
                                                                <i class="ti-bar-chart pr-1"></i> نمودار عملکرد
                                                            </button>
                                                        </a>
                                                    </td>
                                                    <td class="card-text text-center">{{ item.by_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.by_today_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.budget_rate|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.actual_ratio_by_year|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.cy_budget|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_today_budget|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard1 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                    <td class="card-text text-center">{{ item.cy_today_budget_line|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard2 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- سطح 1 -->
            <div class="row">
                <div class="col-md-12 mb-30">
                    <div class="col-xl-12 mb-30">
                        <div class="card card-statistics h-100">
                            <div class="card-body">
                                <div class="table-responsive mt-15 ">
                                    <h5 class="card-title pb-0 border-0">بر اساس سطح 1</h5>
                                    <h6 class="card-title pb-0 border-0">عملکرد فروش مقداری سال {{ acc_year }}</h6>
                                    <div class="table-responsive">
                                        <table id="table1"
                                               class="table-striped"
                                               data-toggle="table"
                                               data-locale="fa-IR"
                                               data-search="true"
                                               data-show-columns="true"
                                               data-show-export="true"
                                               data-show-refresh="true"
                                               data-show-columns-toggle-all="true"
                                               data-show-pagination-switch="true"
                                               data-show-toggle="true"
                                               data-show-fullscreen="true"
                                               data-buttons="buttons"
                                               data-search-align="left"
                                               data-buttons-class="primary"
                                               data-pagination="true"
                                               data-show-columns-search="true"
                                               data-show-footer="true"
                                               data-page-size="100"
                                               data-remember-order="true"
                                               data-sortable="true"
                                               data-show-search-clear-button="true"
                                               data-sort-name="cy_factor"
                                               data-sort-order="desc"
                                               data-filter-control="true"
                                               data-show-print="true"
                                               data-export-data-type="all"
                                               data-export-types='["excel"]'>
                                            <thead>
                                            <tr class="tr-class-1">
                                                <th></th>
                                                <th data-field="l1" class="card-text text-center"
                                                    data-sortable="true" data-filter-control="select">سطح 1
                                                </th>
                                                <th data-field="by_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter"> کل
                                                    فروش{{ base_year }} (تعداد)</th>
                                                <th data-field="by_today_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    فروش{{ base_year }} تا امروز (تعداد)
                                                </th>
                                                <th data-field="budget_rate" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب بودجه
                                                </th>
                                                <th data-field="actual_ratio_by_year" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب واقعی
                                                </th>
                                                <th data-field="cy_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    بودجه{{ acc_year }} (تعداد)</th>
                                                <th data-field="cy_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">فروش{{ acc_year }}تا امروز (تعداد)
                                                </th>
                                                <th data-field="cy_today_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }} با آهنگ
                                                    پارسال تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_year_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (آهنگ پارسال)
                                                </th>
                                                <th data-field="cy_today_budget_line" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }}
                                                    بصورت خطی تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_line_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (خطی)
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for item in table1 %}
                                                <tr>
                                                    <td>
                                                        <a href="/budget/sale/qty/detail/1/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success btn-fixed-width">
                                                                <i class="ti-bar-chart pr-1"></i> نمودار عملکرد
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/factor/{{ acc_year }}/1/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-danger btn-fixed-width">
                                                                <i class="ti-wallet pr-1"></i> فاکتورهای {{ acc_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/factor/{{ base_year }}/1/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-primary btn-fixed-width">
                                                                <i class="ti-wallet pr-1"></i> فاکتورهای {{ base_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/backfactor/{{ acc_year }}/1/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-warning btn-fixed-width">
                                                                <i class="ti-rotate-left pr-1"></i> برگشتی {{ acc_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/backfactor/{{ base_year }}/1/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-secondary btn-fixed-width">
                                                                <i class="ti-rotate-left pr-1"></i> برگشتی {{ base_year }}
                                                            </button>
                                                        </a>
                                                    </td>
                                                    <td class="card-text text-center">{{ item.l1 }}</td>
                                                    <td class="card-text text-center">{{ item.by_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.by_today_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.budget_rate|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.actual_ratio_by_year|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.cy_budget|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_today_budget|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard1 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                    <td class="card-text text-center">{{ item.cy_today_budget_line|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard2 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- سطح 2 -->
            <div class="row">
                <div class="col-md-12 mb-30">
                    <div class="col-xl-12 mb-30">
                        <div class="card card-statistics h-100">
                            <div class="card-body">
                                <div class="table-responsive mt-15 ">
                                    <h5 class="card-title pb-0 border-0">بر اساس سطح 2</h5>
                                    <h6 class="card-title pb-0 border-0">عملکرد فروش مقداری سال {{ acc_year }}</h6>
                                    <div class="table-responsive">
                                        <table id="table2"
                                               class="table-striped"
                                               data-toggle="table"
                                               data-locale="fa-IR"
                                               data-search="true"
                                               data-show-columns="true"
                                               data-show-export="true"
                                               data-show-refresh="true"
                                               data-show-columns-toggle-all="true"
                                               data-show-pagination-switch="true"
                                               data-show-toggle="true"
                                               data-show-fullscreen="true"
                                               data-buttons="buttons"
                                               data-search-align="left"
                                               data-buttons-class="primary"
                                               data-pagination="true"
                                               data-show-columns-search="true"
                                               data-show-footer="true"
                                               data-page-size="100"
                                               data-remember-order="true"
                                               data-sortable="true"
                                               data-show-search-clear-button="true"
                                               data-sort-name="cy_factor"
                                               data-sort-order="desc"
                                               data-filter-control="true"
                                               data-show-print="true"
                                               data-export-data-type="all"
                                               data-export-types='["excel"]'>
                                            <thead>
                                            <tr class="tr-class-1">
                                                <th></th>
                                                <th data-field="l1" class="card-text text-center"
                                                    data-sortable="true" data-filter-control="select">سطح 1
                                                </th>
                                                <th data-field="l2" class="card-text text-center"
                                                    data-sortable="true" data-filter-control="select">سطح 2
                                                </th>
                                                <th data-field="by_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter"> کل
                                                    فروش{{ base_year }} (تعداد)</th>
                                                <th data-field="by_today_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    فروش{{ base_year }} تا امروز (تعداد)
                                                </th>
                                                <th data-field="budget_rate" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب بودجه
                                                </th>
                                                <th data-field="actual_ratio_by_year" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب واقعی
                                                </th>
                                                <th data-field="cy_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    بودجه{{ acc_year }} (تعداد)</th>
                                                <th data-field="cy_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">فروش{{ acc_year }}تا امروز (تعداد)
                                                </th>
                                                <th data-field="cy_today_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }} با آهنگ
                                                    پارسال تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_year_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (آهنگ پارسال)
                                                </th>
                                                <th data-field="cy_today_budget_line" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }}
                                                    بصورت خطی تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_line_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (خطی)
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for item in table2 %}
                                                <tr>
                                                    <td>
                                                        <a href="/budget/sale/qty/detail/2/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success btn-fixed-width">
                                                                <i class="ti-bar-chart pr-1"></i> نمودار عملکرد
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/factor/{{ acc_year }}/2/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-danger btn-fixed-width">
                                                                <i class="ti-wallet pr-1"></i> فاکتورهای {{ acc_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/factor/{{ base_year }}/2/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-primary btn-fixed-width">
                                                                <i class="ti-wallet pr-1"></i> فاکتورهای {{ base_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/backfactor/{{ acc_year }}/2/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-warning btn-fixed-width">
                                                                <i class="ti-rotate-left pr-1"></i> برگشتی {{ acc_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/backfactor/{{ base_year }}/2/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-secondary btn-fixed-width">
                                                                <i class="ti-rotate-left pr-1"></i> برگشتی {{ base_year }}
                                                            </button>
                                                        </a>
                                                    </td>
                                                    <td class="card-text text-center">{{ item.l1 }}</td>
                                                    <td class="card-text text-center">{{ item.l2 }}</td>
                                                    <td class="card-text text-center">{{ item.by_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.by_today_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.budget_rate|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.actual_ratio_by_year|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.cy_budget|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_today_budget|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard1 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                    <td class="card-text text-center">{{ item.cy_today_budget_line|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard2 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- سطح 3 -->
            <div class="row">
                <div class="col-md-12 mb-30">
                    <div class="col-xl-12 mb-30">
                        <div class="card card-statistics h-100">
                            <div class="card-body">
                                <div class="table-responsive mt-15 ">
                                    <h5 class="card-title pb-0 border-0">بر اساس سطح 3</h5>
                                    <h6 class="card-title pb-0 border-0">عملکرد فروش مقداری سال {{ acc_year }} <span
                                            id="total-mandah"
                                            class="text-primary"></span>
                                        عدد </h6>
                                    <div class="table-responsive">
                                        <table id="table3"
                                               class="table-striped"
                                               data-toggle="table"
                                               data-locale="fa-IR"
                                               data-search="true"
                                               data-show-columns="true"
                                               data-show-export="true"
                                               data-show-refresh="true"
                                               data-show-columns-toggle-all="true"
                                               data-show-pagination-switch="true"
                                               data-show-toggle="true"
                                               data-show-fullscreen="true"
                                               data-buttons="buttons"
                                               data-search-align="left"
                                               data-buttons-class="primary"
                                               data-pagination="true"
                                               data-show-columns-search="true"
                                               data-show-footer="true"
                                               data-page-size="100"
                                               data-remember-order="true"
                                               data-sortable="true"
                                               data-show-search-clear-button="true"
                                               data-sort-name="cy_factor"
                                               data-sort-order="desc"
                                               data-filter-control="true"
                                               data-show-print="true"
                                               data-export-data-type="all"
                                               data-export-types='["excel"]'>
                                            <thead>
                                            <tr class="tr-class-1">
                                                <th></th>
                                                <th data-field="l1" class="card-text text-center"
                                                    data-sortable="true" data-filter-control="select">سطح 1
                                                </th>
                                                <th data-field="l2" class="card-text text-center"
                                                    data-sortable="true" data-filter-control="select">سطح 2
                                                </th>
                                                <th data-field="l3" class="card-text text-center"
                                                    data-sortable="true" data-filter-control="select">سطح 3
                                                </th>
                                                <th data-field="by_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter"> کل
                                                    فروش{{ base_year }} (تعداد)</th>
                                                <th data-field="by_today_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    فروش{{ base_year }} تا امروز (تعداد)
                                                </th>
                                                <th data-field="budget_rate" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب بودجه
                                                </th>
                                                <th data-field="actual_ratio_by_year" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly">ضریب واقعی
                                                </th>
                                                <th data-field="cy_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">
                                                    بودجه{{ acc_year }} (تعداد)</th>
                                                <th data-field="cy_factor" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">فروش{{ acc_year }}تا امروز (تعداد)
                                                </th>
                                                <th data-field="cy_today_budget" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }} با آهنگ
                                                    پارسال تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_year_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (آهنگ پارسال)
                                                </th>
                                                <th data-field="cy_today_budget_line" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                    data-footer-formatter="priceFormatter">بودجه{{ acc_year }}
                                                    بصورت خطی تا امروز (تعداد)
                                                </th>
                                                <th data-field="amalkard_by_line_ratio" class="card-text text-center"
                                                    data-sortable="true" data-sorter="numericOnly"
                                                >عملکرد نسبت به بودجه (خطی)
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for item in table3 %}
                                                <tr>
                                                    <td>
                                                        <a href="/budget/sale/qty/detail/3/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-success btn-fixed-width">
                                                                <i class="ti-bar-chart pr-1"></i> نمودار عملکرد
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/factor/{{ acc_year }}/3/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-danger btn-fixed-width">
                                                                <i class="ti-wallet pr-1"></i> فاکتورهای {{ acc_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/factor/{{ base_year }}/3/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-primary btn-fixed-width">
                                                                <i class="ti-wallet pr-1"></i> فاکتورهای {{ base_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/backfactor/{{ acc_year }}/3/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-warning btn-fixed-width">
                                                                <i class="ti-rotate-left pr-1"></i> برگشتی {{ acc_year }}
                                                            </button>
                                                        </a>
                                                        <a href="/budget/sale/backfactor/{{ base_year }}/3/{{ item.cat_id }}"
                                                           target="_blank">
                                                            <button type="button"
                                                                    class="btn btn-sm btn-secondary btn-fixed-width">
                                                                <i class="ti-rotate-left pr-1"></i> برگشتی {{ base_year }}
                                                            </button>
                                                        </a>
                                                    </td>
                                                    <td class="card-text text-center">{{ item.l1 }}</td>
                                                    <td class="card-text text-center">{{ item.l2 }}</td>
                                                    <td class="card-text text-center">{{ item.l3 }}</td>
                                                    <td class="card-text text-center">{{ item.by_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.by_today_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.budget_rate }}</td>
                                                    <td class="card-text text-center">{{ item.actual_ratio_by_year|floatformat:2 }}</td>
                                                    <td class="card-text text-center">{{ item.cy_budget|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_factor|floatformat:0|intcomma:False }}</td>
                                                    <td class="card-text text-center">{{ item.cy_today_budget|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard1 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_year_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                    <td class="card-text text-center">{{ item.cy_today_budget_line|floatformat:0|intcomma:False }}</td>
                                                    {% if item.amalkard2 %}
                                                        <td class="card-text text-center text-success"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% else %}
                                                        <td class="card-text text-center text-danger"
                                                            style="direction: ltr">{{ item.amalkard_by_line_ratio|floatformat:0 }}%
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block date %}
    <script src="{% static 'js/table1/tableExport.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-locale-all.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-export.min.js' %}"></script>
    <script src="{% static 'js/table1/natural-sorting.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-filter-control.min.js' %}"></script>
    <script src="{% static 'js/table1/bootstrap-table-print.min.js' %}"></script>
    <script src="{% static 'js/table1/jspdf.min.js' %}"></script>
    <script src="{% static 'js/table1/jspdf.plugin.autotable.js' %}"></script>
    <script>
        $(function () {
            $('#table, #table1, #table2, #table3').bootstrapTable();
        });
        function priceFormatter(data) {
            var field = this.field;
            var result = data.map(function (row) {
                var valueString = row[field].replace(/,/g, '');
                var value = parseFloat(valueString);
                return isNaN(value) ? 0 : value;
            }).reduce(function (sum, i) {
                return sum + i;
            }, 0);
            return result.toLocaleString('fa-IR');
        }
    </script>
{% endblock %}